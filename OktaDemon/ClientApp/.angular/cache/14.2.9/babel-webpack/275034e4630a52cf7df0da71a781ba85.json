{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport AuthPollStopError from '../../errors/AuthPollStopError.js';\nimport AuthSdkError from '../../errors/AuthSdkError.js';\nimport { delay } from '../../util/misc.js';\nimport { getLink } from '../../util/object.js';\nimport { isNumber, isObject } from '../../util/types.js';\nimport { toQueryString } from '../../util/url.js';\nimport { post } from '../../http/request.js';\nimport { DEFAULT_POLLING_DELAY } from '../../constants.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { getStateToken } from './stateToken.js';\n\nfunction getPollFn(sdk, res, ref) {\n  return function (options) {\n    var delay$1;\n    var rememberDevice;\n    var autoPush;\n    var transactionCallBack;\n\n    if (isNumber(options)) {\n      delay$1 = options;\n    } else if (isObject(options)) {\n      options = options;\n      delay$1 = options.delay;\n      rememberDevice = options.rememberDevice;\n      autoPush = options.autoPush;\n      transactionCallBack = options.transactionCallBack;\n    }\n\n    if (!delay$1 && delay$1 !== 0) {\n      delay$1 = DEFAULT_POLLING_DELAY;\n    }\n\n    var pollLink = getLink(res, 'next', 'poll');\n\n    function pollFn() {\n      var opts = {};\n\n      if (typeof autoPush === 'function') {\n        try {\n          opts.autoPush = !!autoPush();\n        } catch (e) {\n          return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n        }\n      } else if (autoPush !== undefined && autoPush !== null) {\n        opts.autoPush = !!autoPush;\n      }\n\n      if (typeof rememberDevice === 'function') {\n        try {\n          opts.rememberDevice = !!rememberDevice();\n        } catch (e) {\n          return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n        }\n      } else if (rememberDevice !== undefined && rememberDevice !== null) {\n        opts.rememberDevice = !!rememberDevice;\n      }\n\n      var href = pollLink.href + toQueryString(opts);\n      return post(sdk, href, getStateToken(res), {\n        saveAuthnState: false,\n        withCredentials: true\n      });\n    }\n\n    ref.isPolling = true;\n    var retryCount = 0;\n\n    var recursivePoll = function () {\n      if (!ref.isPolling) {\n        return Promise.reject(new AuthPollStopError());\n      }\n\n      return pollFn().then(function (pollRes) {\n        retryCount = 0;\n\n        if (pollRes.factorResult && pollRes.factorResult === 'WAITING') {\n          if (!ref.isPolling) {\n            throw new AuthPollStopError();\n          }\n\n          if (typeof transactionCallBack === 'function') {\n            transactionCallBack(pollRes);\n          }\n\n          return delay(delay$1).then(recursivePoll);\n        } else {\n          ref.isPolling = false;\n          return sdk.tx.createTransaction(pollRes);\n        }\n      }).catch(function (err) {\n        if (err.xhr && (err.xhr.status === 0 || err.xhr.status === 429) && retryCount <= 4) {\n          var delayLength = Math.pow(2, retryCount) * 1000;\n          retryCount++;\n          return delay(delayLength).then(recursivePoll);\n        }\n\n        throw err;\n      });\n    };\n\n    return recursivePoll().catch(function (err) {\n      ref.isPolling = false;\n      throw err;\n    });\n  };\n}\n\nexport { getPollFn };","map":{"version":3,"names":["AuthPollStopError","AuthSdkError","delay","getLink","isNumber","isObject","toQueryString","post","DEFAULT_POLLING_DELAY","getStateToken","getPollFn","sdk","res","ref","options","delay$1","rememberDevice","autoPush","transactionCallBack","pollLink","pollFn","opts","e","Promise","reject","undefined","href","saveAuthnState","withCredentials","isPolling","retryCount","recursivePoll","then","pollRes","factorResult","tx","createTransaction","catch","err","xhr","status","delayLength","Math","pow"],"sources":["C:/Users/Narean/source/repos/OktaDemon/OktaDemon/ClientApp/node_modules/@okta/okta-auth-js/esm/browser/authn/util/poll.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport AuthPollStopError from '../../errors/AuthPollStopError.js';\nimport AuthSdkError from '../../errors/AuthSdkError.js';\nimport { delay } from '../../util/misc.js';\nimport { getLink } from '../../util/object.js';\nimport { isNumber, isObject } from '../../util/types.js';\nimport { toQueryString } from '../../util/url.js';\nimport { post } from '../../http/request.js';\nimport { DEFAULT_POLLING_DELAY } from '../../constants.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { getStateToken } from './stateToken.js';\n\nfunction getPollFn(sdk, res, ref) {\n    return function (options) {\n        var delay$1;\n        var rememberDevice;\n        var autoPush;\n        var transactionCallBack;\n        if (isNumber(options)) {\n            delay$1 = options;\n        }\n        else if (isObject(options)) {\n            options = options;\n            delay$1 = options.delay;\n            rememberDevice = options.rememberDevice;\n            autoPush = options.autoPush;\n            transactionCallBack = options.transactionCallBack;\n        }\n        if (!delay$1 && delay$1 !== 0) {\n            delay$1 = DEFAULT_POLLING_DELAY;\n        }\n        var pollLink = getLink(res, 'next', 'poll');\n        function pollFn() {\n            var opts = {};\n            if (typeof autoPush === 'function') {\n                try {\n                    opts.autoPush = !!autoPush();\n                }\n                catch (e) {\n                    return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n                }\n            }\n            else if (autoPush !== undefined && autoPush !== null) {\n                opts.autoPush = !!autoPush;\n            }\n            if (typeof rememberDevice === 'function') {\n                try {\n                    opts.rememberDevice = !!rememberDevice();\n                }\n                catch (e) {\n                    return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n                }\n            }\n            else if (rememberDevice !== undefined && rememberDevice !== null) {\n                opts.rememberDevice = !!rememberDevice;\n            }\n            var href = pollLink.href + toQueryString(opts);\n            return post(sdk, href, getStateToken(res), {\n                saveAuthnState: false,\n                withCredentials: true\n            });\n        }\n        ref.isPolling = true;\n        var retryCount = 0;\n        var recursivePoll = function () {\n            if (!ref.isPolling) {\n                return Promise.reject(new AuthPollStopError());\n            }\n            return pollFn()\n                .then(function (pollRes) {\n                retryCount = 0;\n                if (pollRes.factorResult && pollRes.factorResult === 'WAITING') {\n                    if (!ref.isPolling) {\n                        throw new AuthPollStopError();\n                    }\n                    if (typeof transactionCallBack === 'function') {\n                        transactionCallBack(pollRes);\n                    }\n                    return delay(delay$1).then(recursivePoll);\n                }\n                else {\n                    ref.isPolling = false;\n                    return sdk.tx.createTransaction(pollRes);\n                }\n            })\n                .catch(function (err) {\n                if (err.xhr &&\n                    (err.xhr.status === 0 || err.xhr.status === 429) &&\n                    retryCount <= 4) {\n                    var delayLength = Math.pow(2, retryCount) * 1000;\n                    retryCount++;\n                    return delay(delayLength)\n                        .then(recursivePoll);\n                }\n                throw err;\n            });\n        };\n        return recursivePoll()\n            .catch(function (err) {\n            ref.isPolling = false;\n            throw err;\n        });\n    };\n}\n\nexport { getPollFn };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}