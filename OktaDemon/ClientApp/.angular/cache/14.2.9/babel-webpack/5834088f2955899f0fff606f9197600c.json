{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Narean/source/repos/OktaDemon/OktaDemon/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport AuthApiError from '../../../errors/AuthApiError.js';\nimport { httpRequest } from '../../../http/request.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { divideActionParamsByMutability } from './actionParser.js';\n\nconst generateDirectFetch = function generateDirectFetch(authClient, {\n  actionDefinition,\n  defaultParamsForAction = {},\n  immutableParamsForAction = {},\n  toPersist = {}\n}) {\n  const target = actionDefinition.href;\n  return /*#__PURE__*/_asyncToGenerator(function* (params = {}) {\n    var _a;\n\n    const headers = {\n      'Content-Type': 'application/json',\n      'Accept': actionDefinition.accepts || 'application/ion+json'\n    };\n    const body = JSON.stringify(Object.assign(Object.assign(Object.assign({}, defaultParamsForAction), params), immutableParamsForAction));\n\n    try {\n      const response = yield httpRequest(authClient, {\n        url: target,\n        method: actionDefinition.method,\n        headers,\n        args: body,\n        withCredentials: (_a = toPersist === null || toPersist === void 0 ? void 0 : toPersist.withCredentials) !== null && _a !== void 0 ? _a : true\n      });\n      return authClient.idx.makeIdxResponse(Object.assign({}, response), toPersist, true);\n    } catch (err) {\n      if (!(err instanceof AuthApiError) || !(err === null || err === void 0 ? void 0 : err.xhr)) {\n        throw err;\n      }\n\n      const response = err.xhr;\n      const payload = response.responseJSON || JSON.parse(response.responseText);\n      const wwwAuthHeader = response.headers['WWW-Authenticate'] || response.headers['www-authenticate'];\n      const idxResponse = authClient.idx.makeIdxResponse(Object.assign({}, payload), toPersist, false);\n\n      if (response.status === 401 && wwwAuthHeader === 'Oktadevicejwt realm=\"Okta Device\"') {\n        idxResponse.stepUp = true;\n      }\n\n      return idxResponse;\n    }\n  });\n};\n\nconst generateIdxAction = function generateIdxAction(authClient, actionDefinition, toPersist) {\n  const generator = generateDirectFetch;\n  const {\n    defaultParams,\n    neededParams,\n    immutableParams\n  } = divideActionParamsByMutability(actionDefinition);\n  const action = generator(authClient, {\n    actionDefinition,\n    defaultParamsForAction: defaultParams[actionDefinition.name],\n    immutableParamsForAction: immutableParams[actionDefinition.name],\n    toPersist\n  });\n  action.neededParams = neededParams;\n  return action;\n};\n\nexport { generateIdxAction as default }; //# sourceMappingURL=generateIdxAction.js.map","map":null,"metadata":{},"sourceType":"module"}