{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Narean/source/repos/OktaDemon/OktaDemon/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport { BroadcastChannel } from 'broadcast-channel';\nimport { isBrowser } from '../features.js';\nimport { EVENT_ADDED, EVENT_REMOVED, EVENT_RENEWED, EVENT_SET_STORAGE } from '../oidc/types/TokenManager.js';\nimport AuthSdkError from '../errors/AuthSdkError.js';\n\nclass SyncStorageService {\n  constructor(tokenManager, options = {}) {\n    this.started = false;\n    this.enablePostMessage = true;\n    this.tokenManager = tokenManager;\n    this.options = options;\n    this.onTokenAddedHandler = this.onTokenAddedHandler.bind(this);\n    this.onTokenRemovedHandler = this.onTokenRemovedHandler.bind(this);\n    this.onTokenRenewedHandler = this.onTokenRenewedHandler.bind(this);\n    this.onSetStorageHandler = this.onSetStorageHandler.bind(this);\n    this.onSyncMessageHandler = this.onSyncMessageHandler.bind(this);\n  }\n\n  requiresLeadership() {\n    return false;\n  }\n\n  isStarted() {\n    return this.started;\n  }\n\n  canStart() {\n    return !!this.options.syncStorage && isBrowser();\n  }\n\n  start() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this.canStart()) {\n        return;\n      }\n\n      yield _this.stop();\n      const {\n        syncChannelName\n      } = _this.options;\n\n      try {\n        _this.channel = new BroadcastChannel(syncChannelName);\n      } catch (err) {\n        throw new AuthSdkError('SyncStorageService is not supported in current browser.');\n      }\n\n      _this.tokenManager.on(EVENT_ADDED, _this.onTokenAddedHandler);\n\n      _this.tokenManager.on(EVENT_REMOVED, _this.onTokenRemovedHandler);\n\n      _this.tokenManager.on(EVENT_RENEWED, _this.onTokenRenewedHandler);\n\n      _this.tokenManager.on(EVENT_SET_STORAGE, _this.onSetStorageHandler);\n\n      _this.channel.addEventListener('message', _this.onSyncMessageHandler);\n\n      _this.started = true;\n    })();\n  }\n\n  stop() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      if (_this2.started) {\n        _this2.tokenManager.off(EVENT_ADDED, _this2.onTokenAddedHandler);\n\n        _this2.tokenManager.off(EVENT_REMOVED, _this2.onTokenRemovedHandler);\n\n        _this2.tokenManager.off(EVENT_RENEWED, _this2.onTokenRenewedHandler);\n\n        _this2.tokenManager.off(EVENT_SET_STORAGE, _this2.onSetStorageHandler);\n\n        (_a = _this2.channel) === null || _a === void 0 ? void 0 : _a.removeEventListener('message', _this2.onSyncMessageHandler);\n        yield (_b = _this2.channel) === null || _b === void 0 ? void 0 : _b.close();\n        _this2.channel = undefined;\n        _this2.started = false;\n      }\n    })();\n  }\n\n  onTokenAddedHandler(key, token) {\n    var _a;\n\n    if (!this.enablePostMessage) {\n      return;\n    }\n\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_ADDED,\n      key,\n      token\n    });\n  }\n\n  onTokenRemovedHandler(key, token) {\n    var _a;\n\n    if (!this.enablePostMessage) {\n      return;\n    }\n\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_REMOVED,\n      key,\n      token\n    });\n  }\n\n  onTokenRenewedHandler(key, token, oldToken) {\n    var _a;\n\n    if (!this.enablePostMessage) {\n      return;\n    }\n\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_RENEWED,\n      key,\n      token,\n      oldToken\n    });\n  }\n\n  onSetStorageHandler(storage) {\n    var _a;\n\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_SET_STORAGE,\n      storage\n    });\n  }\n\n  onSyncMessageHandler(msg) {\n    this.enablePostMessage = false;\n\n    switch (msg.type) {\n      case EVENT_SET_STORAGE:\n        this.tokenManager.getStorage().setStorage(msg.storage);\n        break;\n\n      case EVENT_ADDED:\n        this.tokenManager.emitAdded(msg.key, msg.token);\n        this.tokenManager.setExpireEventTimeout(msg.key, msg.token);\n        break;\n\n      case EVENT_REMOVED:\n        this.tokenManager.clearExpireEventTimeout(msg.key);\n        this.tokenManager.emitRemoved(msg.key, msg.token);\n        break;\n\n      case EVENT_RENEWED:\n        this.tokenManager.emitRenewed(msg.key, msg.token, msg.oldToken);\n        break;\n    }\n\n    this.enablePostMessage = true;\n  }\n\n}\n\nexport { SyncStorageService };","map":{"version":3,"names":["BroadcastChannel","isBrowser","EVENT_ADDED","EVENT_REMOVED","EVENT_RENEWED","EVENT_SET_STORAGE","AuthSdkError","SyncStorageService","constructor","tokenManager","options","started","enablePostMessage","onTokenAddedHandler","bind","onTokenRemovedHandler","onTokenRenewedHandler","onSetStorageHandler","onSyncMessageHandler","requiresLeadership","isStarted","canStart","syncStorage","start","stop","syncChannelName","channel","err","on","addEventListener","_a","_b","off","removeEventListener","close","undefined","key","token","postMessage","type","oldToken","storage","msg","getStorage","setStorage","emitAdded","setExpireEventTimeout","clearExpireEventTimeout","emitRemoved","emitRenewed"],"sources":["C:/Users/Narean/source/repos/OktaDemon/OktaDemon/ClientApp/node_modules/@okta/okta-auth-js/esm/browser/services/SyncStorageService.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { BroadcastChannel } from 'broadcast-channel';\nimport { isBrowser } from '../features.js';\nimport { EVENT_ADDED, EVENT_REMOVED, EVENT_RENEWED, EVENT_SET_STORAGE } from '../oidc/types/TokenManager.js';\nimport AuthSdkError from '../errors/AuthSdkError.js';\n\nclass SyncStorageService {\n    constructor(tokenManager, options = {}) {\n        this.started = false;\n        this.enablePostMessage = true;\n        this.tokenManager = tokenManager;\n        this.options = options;\n        this.onTokenAddedHandler = this.onTokenAddedHandler.bind(this);\n        this.onTokenRemovedHandler = this.onTokenRemovedHandler.bind(this);\n        this.onTokenRenewedHandler = this.onTokenRenewedHandler.bind(this);\n        this.onSetStorageHandler = this.onSetStorageHandler.bind(this);\n        this.onSyncMessageHandler = this.onSyncMessageHandler.bind(this);\n    }\n    requiresLeadership() {\n        return false;\n    }\n    isStarted() {\n        return this.started;\n    }\n    canStart() {\n        return !!this.options.syncStorage && isBrowser();\n    }\n    async start() {\n        if (!this.canStart()) {\n            return;\n        }\n        await this.stop();\n        const { syncChannelName } = this.options;\n        try {\n            this.channel = new BroadcastChannel(syncChannelName);\n        }\n        catch (err) {\n            throw new AuthSdkError('SyncStorageService is not supported in current browser.');\n        }\n        this.tokenManager.on(EVENT_ADDED, this.onTokenAddedHandler);\n        this.tokenManager.on(EVENT_REMOVED, this.onTokenRemovedHandler);\n        this.tokenManager.on(EVENT_RENEWED, this.onTokenRenewedHandler);\n        this.tokenManager.on(EVENT_SET_STORAGE, this.onSetStorageHandler);\n        this.channel.addEventListener('message', this.onSyncMessageHandler);\n        this.started = true;\n    }\n    async stop() {\n        var _a, _b;\n        if (this.started) {\n            this.tokenManager.off(EVENT_ADDED, this.onTokenAddedHandler);\n            this.tokenManager.off(EVENT_REMOVED, this.onTokenRemovedHandler);\n            this.tokenManager.off(EVENT_RENEWED, this.onTokenRenewedHandler);\n            this.tokenManager.off(EVENT_SET_STORAGE, this.onSetStorageHandler);\n            (_a = this.channel) === null || _a === void 0 ? void 0 : _a.removeEventListener('message', this.onSyncMessageHandler);\n            await ((_b = this.channel) === null || _b === void 0 ? void 0 : _b.close());\n            this.channel = undefined;\n            this.started = false;\n        }\n    }\n    onTokenAddedHandler(key, token) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_ADDED,\n            key,\n            token\n        });\n    }\n    onTokenRemovedHandler(key, token) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_REMOVED,\n            key,\n            token\n        });\n    }\n    onTokenRenewedHandler(key, token, oldToken) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_RENEWED,\n            key,\n            token,\n            oldToken\n        });\n    }\n    onSetStorageHandler(storage) {\n        var _a;\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_SET_STORAGE,\n            storage\n        });\n    }\n    onSyncMessageHandler(msg) {\n        this.enablePostMessage = false;\n        switch (msg.type) {\n            case EVENT_SET_STORAGE:\n                this.tokenManager.getStorage().setStorage(msg.storage);\n                break;\n            case EVENT_ADDED:\n                this.tokenManager.emitAdded(msg.key, msg.token);\n                this.tokenManager.setExpireEventTimeout(msg.key, msg.token);\n                break;\n            case EVENT_REMOVED:\n                this.tokenManager.clearExpireEventTimeout(msg.key);\n                this.tokenManager.emitRemoved(msg.key, msg.token);\n                break;\n            case EVENT_RENEWED:\n                this.tokenManager.emitRenewed(msg.key, msg.token, msg.oldToken);\n                break;\n        }\n        this.enablePostMessage = true;\n    }\n}\n\nexport { SyncStorageService };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}